<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Ù…Ø§ÙŠØ§ Ù…ÙŠØ¯ÙŠØ§</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #f8f9fa; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }
        .active-cat { background: #4f46e5 !important; color: white !important; transform: scale(1.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="text-slate-900 pb-40">
    <header class="glass sticky top-0 z-50 p-5 border-b border-white flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-xl text-white shadow-lg">ğŸ“‹</div>
            <div>
                <h1 class="font-black text-slate-800 text-sm leading-none">Ù…Ø§ÙŠØ§ Ù…ÙŠØ¯ÙŠØ§</h1>
                <p id="status-lbl" class="text-[9px] font-bold text-indigo-500 mt-1 uppercase italic"></p>
            </div>
        </div>
    </header>
    <div id="cat-nav" class="flex gap-2 overflow-x-auto p-4 sticky top-[72px] z-40 no-scrollbar bg-slate-50/50 backdrop-blur-sm"></div>
    <main id="content" class="p-4 space-y-10 max-w-lg mx-auto"></main>
    <div id="cart-bar" class="fixed bottom-0 left-0 right-0 p-5 transform translate-y-full transition-all duration-500 z-50">
        <div class="bg-white rounded-[2.5rem] shadow-2xl border border-slate-100 overflow-hidden">
            <div id="delivery-info" class="p-6 bg-slate-50 border-b space-y-4">
                <input type="text" id="cust-address" placeholder="Ø¹Ù†ÙˆØ§Ù†Ùƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„..." class="w-full p-4 rounded-2xl border-none shadow-inner text-sm bg-white outline-none">
                <button onclick="getLocation()" class="w-full bg-indigo-50 text-indigo-600 py-3 rounded-2xl text-[10px] font-black">ğŸ“ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø¨Ø± GPS</button>
                <input type="hidden" id="cust-geo" value="">
            </div>
            <button onclick="sendOrder()" class="w-full bg-indigo-600 text-white h-16 flex items-center justify-between px-10 font-black">
                <div class="flex items-center gap-2"><span id="cart-q" class="bg-white/20 px-3 py-1 rounded-lg text-xs">0</span><span>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</span></div>
                <div class="flex items-center gap-1"><span id="cart-t" class="text-xl">0</span><span class="text-[10px] opacity-70 italic">Ø¯.Ø¹</span></div>
            </button>
        </div>
    </div>
    <script>const structure = ${JSON.stringify(fullStructure)};
        const phone = "${phone}";
        const cafeName = "${name}";
        const deliveryLabel = "${delLabel}";
        let cart = [];
        const tableNum = new URLSearchParams(window.location.search).get('table') || "";

        function init() {
            if(tableNum) {
                document.getElementById('status-lbl').innerText = "ğŸ“ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: " + tableNum;
                document.getElementById('delivery-info').style.display = 'none';
            } else {
                document.getElementById('status-lbl').innerText = "ğŸ›µ " + deliveryLabel;
            }
            renderNav();
            showCategory(0);
        }

        function renderNav() {
            document.getElementById('cat-nav').innerHTML = structure.map((c, i) => `
                <button onclick="showCategory(\${i})" id="btn-cat-\${i}" class="px-6 py-3 rounded-2xl font-black whitespace-nowrap transition-all shadow-sm bg-white text-slate-400">\${c.name}</button>
            `).join('');
        }

        function showCategory(index) {
            document.querySelectorAll('[id^="btn-cat-"]').forEach(b => b.classList.remove('active-cat'));
            const targetBtn = document.getElementById('btn-cat-'+index);
            if(targetBtn) targetBtn.classList.add('active-cat');
            
            const cat = structure[index];
            if(!cat) return;
            document.getElementById('content').innerHTML = cat.types.map(type => `
                <section>
                    <h2 class="text-xs font-black text-indigo-600 mb-5 flex items-center gap-2 uppercase tracking-tighter">
                        <span class="w-4 h-1 bg-indigo-500 rounded-full"></span> \${type.name}
                    </h2>
                    <div class="grid gap-4">
                        \${type.items.map(item => `
                            <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100">
                                <h3 class="font-black text-slate-800 text-sm mb-4">\${item.name}</h3>
                                <div class="space-y-3">
                                    \${item.variants.map(v => `
                                        <div class="flex justify-between items-center bg-slate-50/50 p-3 rounded-2xl border border-slate-50">
                                            <div class="flex flex-col">
                                                <span class="text-[10px] font-black text-slate-400 uppercase">\${v.label}</span>
                                                <span class="text-xs font-black text-slate-700 font-mono">\${v.price.toLocaleString()} Ø¯.Ø¹</span>
                                            </div>
                                            <div class="flex items-center gap-4">
                                                \${getQty(item.name, v.label) > 0 ? `
                                                    <button onclick="updateCart(\\'${item.name}\\',\\'${v.label}\\',${v.price},-1)" class="w-9 h-9 bg-white rounded-xl shadow-sm border text-slate-400 font-black">-</button>
                                                    <span class="text-xs font-black text-indigo-600 w-5 text-center">\${getQty(item.name, v.label)}</span>
                                                ` : ''}
                                                <button onclick="updateCart(\\'${item.name}\\',\\'${v.label}\\',${v.price},1)" class="w-9 h-9 bg-indigo-600 text-white rounded-xl shadow-md font-black">+</button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </section>
            `).join('');
        }

        function updateCart(name, label, price, d) {
            const idx = cart.findIndex(c => c.name === name && c.label === label);
            if(idx > -1) { cart[idx].qty += d; if(cart[idx].qty <= 0) cart.splice(idx, 1); }
            else if(d > 0) { cart.push({name, label, price, qty: 1}); }
            updateCartUI();
            const activeCatIdx = structure.findIndex(c => c.name === document.querySelector('.active-cat').innerText);
            showCategory(activeCatIdx);
        }

        function getQty(name, label) {
            const found = cart.find(c => c.name === name && c.label === label);
            return found ? found.qty : 0;
        }

        function updateCartUI() {
            const count = cart.reduce((a, b) => a + b.qty, 0);
            const total = cart.reduce((a, b) => a + (b.price * b.qty), 0);
            document.getElementById('cart-bar').style.transform = count > 0 ? 'translateY(0)' : 'translateY(100%)';
            document.getElementById('cart-q').innerText = count;
            document.getElementById('cart-t').innerText = total.toLocaleString();
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    document.getElementById('cust-geo').value = "https://www.google.com/maps?q=" + p.coords.latitude + "," + p.coords.longitude;
                    alert("ğŸ“ ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù€ GPS Ø¨Ù†Ø¬Ø§Ø­!");
                }, () => alert("ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ GPS ÙÙŠ Ù‡Ø§ØªÙÙƒ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©."));
            }
        }

        function sendOrder() {
            let m = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† \${cafeName}*\\n`;
            if(tableNum) { m += `ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: \${tableNum}\\n`; } 
            else {
                const addr = document.getElementById('cust-address').value;
                const geo = document.getElementById('cust-geo').value;
                m += `ğŸ›µ \${deliveryLabel}\\n`;
                if(addr) m += `ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: \${addr}\\n`;
                if(geo) m += `ğŸ—ºï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹: \${geo}\\n`;
            }
            m += `\\n--- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ---\\n`;
            cart.forEach(c => m += `â€¢ \${c.name} [\${c.label}] x\${c.qty}\\n`);
            m += `\\nğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: \${cart.reduce((a, b) => a + (b.price * b.qty), 0).toLocaleString()} Ø¯.Ø¹*`;
            window.location.href = `https://wa.me/\${phone}?text=${encodeURIComponent(m)}`;
        }

        window.onload = init;</script>
</body>
</html>
