<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ŸÖÿ±ŸäŸÖ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #f8f9fa; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-40">
    <header class="sticky top-0 z-50 bg-white/80 backdrop-blur-md p-5 border-b flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-2xl flex items-center justify-center text-xl text-white shadow-lg shadow-indigo-100">üìã</div>
            <div>
                <h1 class="font-black text-sm text-slate-800 leading-none">ŸÖÿ±ŸäŸÖ</h1>
                <p id="lbl" class="text-[9px] font-black text-indigo-500 mt-1 uppercase italic tracking-tighter"></p>
            </div>
        </div>
    </header>

    <div id="nav" class="flex gap-2 overflow-x-auto p-4 sticky top-[72px] z-40 no-scrollbar bg-slate-50/50 backdrop-blur-sm"></div>
    <main id="main" class="p-4 max-w-lg mx-auto"></main>

    <div id="cart" class="fixed bottom-0 left-0 right-0 p-5 transform translate-y-[120%] transition-all duration-500 z-50">
        <div class="bg-white rounded-[2.5rem] shadow-2xl border border-slate-100 overflow-hidden">
            <div id="del-box" class="p-6 bg-slate-50 border-b space-y-4 text-center">
                <input type="text" id="addr" placeholder="ÿßŸÉÿ™ÿ® ÿπŸÜŸàÿßŸÜŸÉ ÿ®ÿßŸÑÿ™ŸÅÿµŸäŸÑ ŸáŸÜÿß..." class="w-full p-4 rounded-2xl border-none shadow-inner text-sm outline-none">
                <button onclick="getLoc()" class="w-full bg-indigo-50 text-indigo-600 py-3 rounded-2xl text-[10px] font-black italic tracking-wider">üìç ÿ•ÿ±ÿ≥ÿßŸÑ ŸÖŸàŸÇÿπ ÿßŸÑŸÄ GPS ÿßŸÑÿ≠ÿßŸÑŸä</button>
                <input type="hidden" id="geo" value="">
            </div>
            <button onclick="send()" class="w-full bg-indigo-600 text-white h-16 flex items-center justify-between px-10 font-black">
                <div class="flex items-center gap-2"><span id="cq" class="bg-white/20 px-3 py-1 rounded-lg text-xs">0</span><span>ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®</span></div>
                <div class="flex items-center gap-1"><span id="ct" class="text-xl">0</span><span class="text-[10px] opacity-70">ÿØ.ÿπ</span></div>
            </button>
        </div>
    </div>
    <script>
                const data = ${JSON.stringify(data)};
                const phone = "9647711411064";
                const cafeName = "ŸÖÿ±ŸäŸÖ";
                const delLabel = "ÿÆÿØŸÖÿßÿ™ ÿßŸÑŸÉŸÑÿßŸàÿßÿ™";
                let cart = [];
                const table = new URLSearchParams(window.location.search).get('table');

                function init() {
                    document.getElementById('lbl').innerText = table ? "üìç ÿ∑ÿßŸàŸÑÿ©: " + table : "üõµ " + delLabel;
                    if(table) document.getElementById('del-box').style.display = 'none';
                    renderNav();
                    show(0);
                }

                function renderNav() {
                    document.getElementById('nav').innerHTML = data.map((c, i) => `
                        <button onclick="show(\${i})" class="nav-btn px-6 py-3 rounded-2xl font-black bg-white shadow-sm whitespace-nowrap">\${c.name}</button>
                    `).join('');
                }

                function show(idx) {
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('bg-indigo-600','text-white'));
                    const btns = document.querySelectorAll('.nav-btn');
                    if(btns[idx]) btns[idx].classList.add('bg-indigo-600','text-white');
                    
                    const cat = data[idx];
                    document.getElementById('main').innerHTML = cat.types.map(t => `
                        <div class="mb-8">
                            <h2 class="text-indigo-600 font-black text-xs mb-4 uppercase tracking-widest flex items-center gap-2">
                                <span class="w-2 h-2 bg-indigo-600 rounded-full"></span>\${t.name}
                            </h2>
                            <div class="grid gap-3">
                                \${t.items.map(item => `
                                    <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100">
                                        <h3 class="font-black text-sm mb-4">\${item.name}</h3>
                                        <div class="space-y-2">
                                            \${item.variants.map(v => `
                                                <div class="flex justify-between items-center bg-slate-50 p-3 rounded-2xl">
                                                    <div>
                                                        <p class="text-[9px] text-slate-400 font-bold uppercase">\${v.label}</p>
                                                        <p class="font-black text-xs">\${v.price.toLocaleString()} ÿØ.ÿπ</p>
                                                    </div>
                                                    <div class="flex items-center gap-4">
                                                        \${getQty(item.name, v.label) > 0 ? `
                                                            <button onclick="upd(\\'${item.name}\\',\\'${v.label}\\',${v.price},-1)" class="w-8 h-8 bg-white rounded-xl shadow-sm border font-bold">-</button>
                                                            <span class="font-black text-xs text-indigo-600">\${getQty(item.name, v.label)}</span>
                                                        ` : ''}
                                                        <button onclick="upd(\\'${item.name}\\',\\'${v.label}\\',${v.price},1)" class="w-8 h-8 bg-indigo-600 text-white rounded-xl shadow-md font-bold">+</button>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');
                }

                function upd(n, l, p, d) {
                    const i = cart.findIndex(x => x.n === n && x.l === l);
                    if(i > -1) { cart[i].q += d; if(cart[i].q <= 0) cart.splice(i, 1); }
                    else if(d > 0) cart.push({n, l, p, q: 1});
                    
                    const count = cart.reduce((a, b) => a + b.q, 0);
                    const total = cart.reduce((a, b) => a + (b.p * b.q), 0);
                    document.getElementById('cart').style.transform = count > 0 ? 'translateY(0)' : 'translateY(110%)';
                    document.getElementById('cq').innerText = count;
                    document.getElementById('ct').innerText = total.toLocaleString();
                    
                    const activeIdx = data.findIndex(c => c.name === document.querySelector('.bg-indigo-600').innerText);
                    show(activeIdx);
                }

                function getQty(n, l) {
                    const x = cart.find(i => i.n === n && i.l === l);
                    return x ? x.q : 0;
                }

                function getLoc() {
                    navigator.geolocation.getCurrentPosition(p => {
                        document.getElementById('geo').value = "https://www.google.com/maps?q=" + p.coords.latitude + "," + p.coords.longitude;
                        alert("‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ŸÖŸàŸÇÿπŸÉ!");
                    });
                }

                function send() {
                    let m = `*ÿ∑ŸÑÿ® ÿ¨ÿØŸäÿØ ŸÖŸÜ \${cafeName}*\\n`;
                    if(table) m += `üìç ÿ∑ÿßŸàŸÑÿ©: \${table}\\n`;
                    else {
                        m += `üõµ \${delLabel}\\n`;
                        const a = document.getElementById('addr').value;
                        const g = document.getElementById('geo').value;
                        if(a) m += `üè† ÿßŸÑÿπŸÜŸàÿßŸÜ: \${a}\\n`;
                        if(g) m += `üó∫Ô∏è ÿßŸÑŸÖŸàŸÇÿπ: \${g}\\n`;
                    }
                    m += `\\n--- ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ---\\n`;
                    cart.forEach(i => m += `‚Ä¢ \${i.n} [\${i.l}] x\${i.q}\\n`);
                    m += `\\nüí∞ *ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: \${cart.reduce((a, b) => a + (b.p * b.q), 0).toLocaleString()} ÿØ.ÿπ*`;
                    window.location.href = `https://wa.me/\${phone}?text=${encodeURIComponent(m)}`;
                }
                window.onload = init;
            </script>
</body>
</html>
