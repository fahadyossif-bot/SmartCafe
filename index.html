<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø´Ø¦ Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ø´Ø¬Ø±ÙŠ Ø§Ù„Ù…ØªØ·ÙˆØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #f8fafc; }
        .card { background: white; border-radius: 1.5rem; border: 1px solid #e2e8f0; padding: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        input { border-radius: 0.75rem; border: 1px solid #cbd5e1; padding: 0.75rem; outline: none; font-size: 0.875rem; transition: 0.2s; }
        input:focus { border-color: #6366f1; ring: 2px; ring-color: #6366f1; }
        .variant-row { display: grid; grid-template-columns: 1fr 1fr auto; gap: 0.5rem; margin-top: 0.5rem; }
    </style>
</head>
<body class="pb-24">

    <div class="max-w-3xl mx-auto p-4 space-y-6">
        <!-- Header -->
        <div class="bg-indigo-600 text-white p-8 rounded-[2rem] shadow-xl text-center">
            <h1 class="text-3xl font-black mb-2">Ù…ØµÙ†Ø¹ Ø§Ù„Ù…Ù†ÙŠÙˆ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ ğŸ—ï¸</h1>
            <p class="opacity-80 text-sm italic">Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø¬Ø±Ø©: Ø£ØµÙ†Ø§Ù > Ø£Ù†ÙˆØ§Ø¹ > Ø¹Ù†Ø§ØµØ± > Ø®ÙŠØ§Ø±Ø§Øª</p>
        </div>

        <!-- Basic Info -->
        <div class="card">
            <h3 class="font-black text-indigo-600 mb-4 border-b pb-2">1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡ÙˆÙŠØ©</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] font-bold text-slate-400 mr-2">Ø§Ø³Ù… Ø§Ù„Ù†Ø´Ø§Ø·</label>
                    <input type="text" id="cafe-name" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø·Ø¹Ù… ÙˆÙƒØ§ÙÙŠÙ‡ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©">
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] font-bold text-slate-400 mr-2">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ (Ø¨Ø¯ÙˆÙ† +)</label>
                    <input type="text" id="cafe-phone" placeholder="9647800000000" class="text-left" dir="ltr">
                </div>
            </div>
        </div>

        <!-- Structure Editor -->
        <div id="categories-container" class="space-y-6">
            <!-- Categories will be added here -->
        </div>

        <button onclick="addCategory()" class="w-full py-4 bg-white border-2 border-dashed border-indigo-200 text-indigo-500 rounded-2xl font-bold hover:bg-indigo-50 transition-all">
            + Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø±Ø¦ÙŠØ³ÙŠ Ø¬Ø¯ÙŠØ¯
        </button>

        <!-- Final Action -->
        <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/80 backdrop-blur-md border-t">
            <div class="max-w-3xl mx-auto flex gap-3">
                <button onclick="generateFinalCode()" class="flex-1 bg-indigo-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-indigo-100 active:scale-95 transition-all">
                    ØªÙˆÙ„ÙŠØ¯ ÙˆÙ†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ÙŠÙˆ (GitHub) ğŸš€
                </button>
            </div>
        </div>
    </div>

    <!-- Templates -->
    <script>
        function addCategory() {
            const catId = Date.now();
            const html = `
                <div id="cat-${catId}" class="card border-r-8 border-r-indigo-500">
                    <div class="flex justify-between items-center mb-4">
                        <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ù…Ø«Ù„Ø§Ù‹: Ø¨ÙŠØªØ²Ø§)" class="font-black text-indigo-600 bg-indigo-50 border-none w-2/3 cat-name">
                        <button onclick="removeElement('cat-${catId}')" class="text-red-400 text-xs font-bold">Ø­Ø°Ù Ø§Ù„Ù‚Ø³Ù…</button>
                    </div>
                    <div id="types-container-${catId}" class="space-y-4 mr-4"></div>
                    <button onclick="addType(${catId})" class="mt-4 text-xs font-bold text-blue-500">+ Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ (Ù…Ø«Ù„Ø§Ù‹: Ø¨ÙŠØªØ²Ø§ Ø¥ÙŠØ·Ø§Ù„ÙŠØ©)</button>
                </div>
            `;
            document.getElementById('categories-container').insertAdjacentHTML('beforeend', html);
        }

        function addType(catId) {
            const typeId = Date.now();
            const html = `
                <div id="type-${typeId}" class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                    <div class="flex justify-between items-center mb-3">
                        <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù†ÙˆØ¹" class="font-bold text-slate-700 bg-white w-1/2 type-name">
                        <button onclick="removeElement('type-${typeId}')" class="text-red-400 text-[10px]">Ø­Ø°Ù Ø§Ù„Ù†ÙˆØ¹</button>
                    </div>
                    <div id="items-container-${typeId}" class="space-y-3 mr-4"></div>
                    <button onclick="addItem(${typeId})" class="mt-2 text-[10px] font-bold text-emerald-600">+ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± (Ø§Ù„ÙˆØ¬Ø¨Ø©)</button>
                </div>
            `;
            document.getElementById(`types-container-${catId}`).insertAdjacentHTML('beforeend', html);
        }

        function addItem(typeId) {
            const itemId = Date.now();
            const html = `
                <div id="item-${itemId}" class="p-3 bg-white rounded-lg border border-slate-100 shadow-sm item-data">
                    <div class="flex justify-between items-center mb-2">
                        <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±" class="font-bold text-sm w-full item-name border-none focus:ring-0">
                        <button onclick="removeElement('item-${itemId}')" class="text-red-300">âœ•</button>
                    </div>
                    <div id="variants-container-${itemId}" class="space-y-1"></div>
                    <button onclick="addVariant(${itemId})" class="text-[9px] font-bold text-slate-400 mt-2 hover:text-indigo-500">+ Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± (Ø­Ø¬Ù…/Ø³Ø¹Ø±)</button>
                </div>
            `;
            document.getElementById(`items-container-${typeId}`).insertAdjacentHTML('beforeend', html);
        }

        function addVariant(itemId) {
            const vId = Date.now();
            const html = `
                <div id="v-${vId}" class="variant-row">
                    <input type="text" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± (Ø¯Ø¨Ù„)" class="text-[10px] v-label p-1">
                    <input type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="text-[10px] v-price p-1">
                    <button onclick="removeElement('v-${vId}')" class="text-red-300 px-1 text-xs">âœ•</button>
                </div>
            `;
            document.getElementById(`variants-container-${itemId}`).insertAdjacentHTML('beforeend', html);
        }

        function removeElement(id) { document.getElementById(id).remove(); }

        function generateFinalCode() {
            const name = document.getElementById('cafe-name').value || "Ù…Ù†ÙŠÙˆ Ø§Ø­ØªØ±Ø§ÙÙŠ";
            const phone = document.getElementById('cafe-phone').value || "000";
            
            const fullStructure = [];
            document.querySelectorAll('[id^="cat-"]').forEach(catDiv => {
                const category = {
                    name: catDiv.querySelector('.cat-name').value,
                    types: []
                };
                catDiv.querySelectorAll('[id^="type-"]').forEach(typeDiv => {
                    const type = {
                        name: typeDiv.querySelector('.type-name').value,
                        items: []
                    };
                    typeDiv.querySelectorAll('.item-data').forEach(itemDiv => {
                        const item = {
                            name: itemDiv.querySelector('.item-name').value,
                            variants: []
                        };
                        itemDiv.querySelectorAll('.variant-row').forEach(vDiv => {
                            item.variants.push({
                                label: vDiv.querySelector('.v-label').value,
                                price: parseInt(vDiv.querySelector('.v-price').value) || 0
                            });
                        });
                        type.items.push(item);
                    });
                    category.types.push(type);
                });
                fullStructure.push(category);
            });

            // ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ HTML Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø²Ø¨ÙˆÙ†
            const finalHTML = `<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>${name}</title>
    <script src="https://cdn.tailwindcss.com"><\/script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #f8f9fa; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }
        .active-cat { background: #4f46e5; color: white; transform: scale(1.05); }
    </style>
</head>
<body class="text-slate-900 pb-24">
    <header class="glass sticky top-0 z-50 p-5 border-b border-white flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-xl text-white shadow-lg">ğŸ“‹</div>
            <div>
                <h1 class="font-black text-slate-800 text-sm">${name}</h1>
                <p id="table-lbl" class="text-[9px] font-bold text-indigo-500 uppercase"></p>
            </div>
        </div>
    </header>

    <div id="cat-nav" class="flex gap-2 overflow-x-auto p-4 sticky top-[72px] z-40 no-scrollbar bg-slate-50/50 backdrop-blur-sm"></div>

    <main id="content" class="p-4 space-y-8 max-w-lg mx-auto"></main>

    <div id="cart-bar" class="fixed bottom-0 left-0 right-0 p-5 transform translate-y-full transition-all duration-500 z-50">
        <button onclick="sendOrder()" class="w-full bg-indigo-600 text-white h-14 rounded-2xl flex items-center justify-between px-6 font-black shadow-xl active:scale-95 transition-all">
            <div class="flex items-center gap-2"><span id="cart-q" class="bg-white/20 px-2 py-0.5 rounded-lg text-xs">0</span><span>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</span></div>
            <div class="flex items-center gap-1"><span id="cart-t" class="text-lg">0</span><span class="text-[10px] opacity-70">Ø¯.Ø¹</span></div>
        </button>
    </div>

    <script>
        const structure = ${JSON.stringify(fullStructure)};
        const phone = "${phone}";
        const cafeName = "${name}";
        let cart = [];
        const tableNum = new URLSearchParams(window.location.search).get('table') || "";

        function init() {
            if(tableNum) document.getElementById('table-lbl').innerText = "ğŸ“ Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: " + tableNum;
            renderNav();
            showCategory(0);
        }

        function renderNav() {
            document.getElementById('cat-nav').innerHTML = structure.map((c, i) => \`
                <button onclick="showCategory(\${i})" id="btn-cat-\${i}" class="px-5 py-2.5 rounded-xl font-bold whitespace-nowrap transition-all shadow-sm bg-white text-slate-400">\${c.name}</button>
            \`).join('');
        }

        function showCategory(index) {
            document.querySelectorAll('[id^="btn-cat-"]').forEach(b => b.classList.remove('active-cat', 'shadow-indigo-100'));
            document.getElementById('btn-cat-'+index).classList.add('active-cat', 'shadow-indigo-100');
            
            const cat = structure[index];
            document.getElementById('content').innerHTML = cat.types.map(type => \`
                <section>
                    <h2 class="text-sm font-black text-indigo-600 mb-4 flex items-center gap-2">
                        <span class="w-1 h-4 bg-indigo-500 rounded-full"></span> \${type.name}
                    </h2>
                    <div class="grid gap-3">
                        \${type.items.map(item => \`
                            <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                                <h3 class="font-bold text-slate-800 text-sm mb-3">\${item.name}</h3>
                                <div class="space-y-2">
                                    \${item.variants.map(v => \`
                                        <div class="flex justify-between items-center bg-slate-50 p-2 rounded-xl">
                                            <span class="text-[10px] font-bold text-slate-500">\${v.label} <span class="mx-1 text-slate-300">|</span> \${v.price.toLocaleString()} Ø¯.Ø¹</span>
                                            <div class="flex items-center gap-3">
                                                \${getQty(item.name, v.label) > 0 ? \`
                                                    <button onclick="updateCart('\${item.name}','\${v.label}',\${v.price},-1)" class="w-7 h-7 bg-white rounded-lg shadow-sm border text-slate-400 font-bold">-</button>
                                                    <span class="text-xs font-black text-indigo-600">\${getQty(item.name, v.label)}</span>
                                                \` : ''}
                                                <button onclick="updateCart('\${item.name}','\${v.label}',\${v.price},1)" class="w-7 h-7 bg-indigo-600 text-white rounded-lg shadow-md font-bold">+</button>
                                            </div>
                                        </div>
                                    \`).join('')}
                                </div>
                            </div>
                        \`).join('')}
                    </div>
                </section>
            \`).join('');
            window.scrollTo(0,0);
        }

        function updateCart(name, label, price, d) {
            const idx = cart.findIndex(c => c.name === name && c.label === label);
            if(idx > -1) {
                cart[idx].qty += d;
                if(cart[idx].qty <= 0) cart.splice(idx, 1);
            } else if(d > 0) {
                cart.push({name, label, price, qty: 1});
            }
            showCategory(structure.findIndex(c => c.types.some(t => t.items.some(i => i.name === name))));
            updateCartUI();
        }

        function getQty(name, label) {
            const found = cart.find(c => c.name === name && c.label === label);
            return found ? found.qty : 0;
        }

        function updateCartUI() {
            const count = cart.reduce((a, b) => a + b.qty, 0);
            const total = cart.reduce((a, b) => a + (b.price * b.qty), 0);
            document.getElementById('cart-bar').style.transform = count > 0 ? 'translateY(0)' : 'translateY(100%)';
            document.getElementById('cart-q').innerText = count;
            document.getElementById('cart-t').innerText = total.toLocaleString();
        }

        function sendOrder() {
            let m = \`*Ø·Ù„Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© - \${cafeName}*\\n\`;
            m += tableNum ? \`ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ø·Ø§ÙˆÙ„Ø©: \${tableNum}\\n\\n\` : \`ğŸ›µ Ø§Ø³ØªÙ„Ø§Ù… Ø®Ø§Ø±Ø¬ÙŠ\\n\\n\`;
            cart.forEach(c => m += \`â€¢ \${c.name} [\${c.label}] x\${c.qty}\\n\`);
            m += \`\\nğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: \${cart.reduce((a, b) => a + (b.price * b.qty), 0).toLocaleString()} Ø¯.Ø¹*\`;
            window.location.href = \`https://wa.me/\${phone}?text=\${encodeURIComponent(m)}\`;
        }

        window.onload = init;
    <\/script>
</body>
</html>`;

            // ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø³Ø®
            const dummy = document.createElement("textarea");
            document.body.appendChild(dummy);
            dummy.value = finalHTML;
            dummy.select();
            document.execCommand("copy");
            document.body.removeChild(dummy);
            alert("âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù†ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù†Ø³Ø® Ø§Ù„Ø¢Ù† Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ GitHub.");
        }

        // Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù‚Ø³Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        addCategory();
    </script>
</body>
</html>
